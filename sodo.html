import React, { useState } from 'react';
import { BookOpen, Beaker, atom, ArrowRight, Table, Info, ChevronDown, ChevronUp, Layers, Zap, FlaskConical, Droplet } from 'lucide-react';

const MindMapNode = ({ title, children, color = "blue", icon: Icon }) => {
  const [isOpen, setIsOpen] = useState(true);

  const colorClasses = {
    blue: "border-l-4 border-blue-500 bg-blue-50/50 dark:bg-blue-900/20",
    green: "border-l-4 border-emerald-500 bg-emerald-50/50 dark:bg-emerald-900/20",
    purple: "border-l-4 border-purple-500 bg-purple-50/50 dark:bg-purple-900/20",
    red: "border-l-4 border-rose-500 bg-rose-50/50 dark:bg-rose-900/20",
    orange: "border-l-4 border-orange-500 bg-orange-50/50 dark:bg-orange-900/20",
  };

  const titleColors = {
    blue: "text-blue-700 dark:text-blue-300",
    green: "text-emerald-700 dark:text-emerald-300",
    purple: "text-purple-700 dark:text-purple-300",
    red: "text-rose-700 dark:text-rose-300",
    orange: "text-orange-700 dark:text-orange-300",
  };

  return (
    <div className={`mb-4 rounded-r-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden ${colorClasses[color]} transition-all duration-300`}>
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="w-full flex items-center justify-between p-3 text-left focus:outline-none"
      >
        <div className="flex items-center gap-3">
          {Icon && <Icon className={`w-5 h-5 ${titleColors[color]}`} />}
          <h3 className={`font-bold text-lg ${titleColors[color]}`}>{title}</h3>
        </div>
        {isOpen ? <ChevronUp className="w-5 h-5 opacity-50" /> : <ChevronDown className="w-5 h-5 opacity-50" />}
      </button>
      
      {isOpen && (
        <div className="p-3 pt-0 pl-4 border-t border-dashed border-gray-300 dark:border-gray-700 mt-2 mx-2">
          <div className="pt-2 text-gray-700 dark:text-gray-300 space-y-2">
            {children}
          </div>
        </div>
      )}
    </div>
  );
};

const SubNode = ({ title, content, highlight }) => (
  <div className="ml-2 pl-4 border-l-2 border-gray-300 dark:border-gray-600 py-1 hover:border-blue-400 transition-colors">
    <div className="font-semibold text-gray-800 dark:text-gray-100">{title}</div>
    <div className={`text-sm mt-1 ${highlight ? 'text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-900/20 p-1 rounded inline-block' : 'text-gray-600 dark:text-gray-400'}`}>
      {content}
    </div>
  </div>
);

const ComparisonTable = ({ onClose }) => (
  <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div className="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-auto animate-in fade-in zoom-in duration-200">
      <div className="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800">
        <h2 className="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
          <Table className="w-5 h-5 text-blue-500" /> Bảng Tổng Hợp So Sánh
        </h2>
        <button onClick={onClose} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">✕</button>
      </div>
      <div className="p-4 overflow-x-auto">
        <table className="w-full text-left text-sm border-collapse">
          <thead>
            <tr className="bg-gray-100 dark:bg-gray-900">
              <th className="p-3 border dark:border-gray-700 rounded-tl-lg">Đặc điểm</th>
              <th className="p-3 border dark:border-gray-700 text-blue-600 dark:text-blue-400">Amin</th>
              <th className="p-3 border dark:border-gray-700 text-emerald-600 dark:text-emerald-400">Amino Axit</th>
              <th className="p-3 border dark:border-gray-700 text-purple-600 dark:text-purple-400">Peptit / Protein</th>
            </tr>
          </thead>
          <tbody className="text-gray-700 dark:text-gray-300">
            <tr>
              <td className="p-3 border dark:border-gray-700 font-semibold">Cấu tạo</td>
              <td className="p-3 border dark:border-gray-700">Gốc Hidrocacbon + NH₂</td>
              <td className="p-3 border dark:border-gray-700">Tạp chức (NH₂ và COOH)</td>
              <td className="p-3 border dark:border-gray-700">Chuỗi các α-amino axit (lk Peptit)</td>
            </tr>
            <tr>
              <td className="p-3 border dark:border-gray-700 font-semibold">Quỳ tím</td>
              <td className="p-3 border dark:border-gray-700">Amin béo → Xanh<br/><span className="text-xs text-gray-500">Anilin không đổi</span></td>
              <td className="p-3 border dark:border-gray-700">Tùy số nhóm NH₂ và COOH<br/><span className="text-xs text-gray-500">(Lys: Xanh, Glu: Đỏ)</span></td>
              <td className="p-3 border dark:border-gray-700">Không đổi màu</td>
            </tr>
            <tr>
              <td className="p-3 border dark:border-gray-700 font-semibold">Tính chất đặc trưng</td>
              <td className="p-3 border dark:border-gray-700">Tính Bazơ</td>
              <td className="p-3 border dark:border-gray-700">Tính Lưỡng tính</td>
              <td className="p-3 border dark:border-gray-700">Thủy phân</td>
            </tr>
            <tr>
              <td className="p-3 border dark:border-gray-700 font-semibold">Phản ứng màu</td>
              <td className="p-3 border dark:border-gray-700">Anilin + Br₂ → Tủa trắng</td>
              <td className="p-3 border dark:border-gray-700">Không có phản ứng màu đặc trưng</td>
              <td className="p-3 border dark:border-gray-700">Màu Biure (Tím)<br/>HNO₃ (Vàng)</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div className="p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-right">
        <button onClick={onClose} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Đã hiểu</button>
      </div>
    </div>
  </div>
);

const App = () => {
  const [activeTab, setActiveTab] = useState('amin');
  const [showTable, setShowTable] = useState(false);

  const tabs = [
    { id: 'amin', label: 'Bài 1: Amin', color: 'blue', icon: Zap },
    { id: 'aa', label: 'Bài 2: Amino Axit', color: 'green', icon: FlaskConical },
    { id: 'protein', label: 'Bài 3: Peptit & Protein', color: 'purple', icon: Layers },
  ];

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950 font-sans transition-colors duration-300">
      {/* Header */}
      <header className="bg-white dark:bg-gray-900 shadow-sm sticky top-0 z-40 border-b border-gray-200 dark:border-gray-800">
        <div className="max-w-3xl mx-auto px-4 py-3 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="bg-blue-600 p-2 rounded-lg">
              <BookOpen className="w-5 h-5 text-white" />
            </div>
            <div>
              <h1 className="font-bold text-gray-900 dark:text-white text-lg leading-tight">Hóa Học 12</h1>
              <p className="text-xs text-gray-500 dark:text-gray-400">Chương 3: Amin, Amino Axit, Protein</p>
            </div>
          </div>
          <button 
            onClick={() => setShowTable(true)}
            className="p-2 bg-gray-100 dark:bg-gray-800 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400 transition-colors"
            title="Xem bảng so sánh"
          >
            <Table className="w-5 h-5" />
          </button>
        </div>
        
        {/* Navigation Tabs */}
        <div className="flex overflow-x-auto no-scrollbar border-b border-gray-200 dark:border-gray-800">
          {tabs.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 whitespace-nowrap text-sm font-medium transition-all
                ${activeTab === tab.id 
                  ? `text-${tab.color}-600 border-b-2 border-${tab.color}-600 bg-${tab.color}-50/50 dark:bg-${tab.color}-900/10 dark:text-${tab.color}-400` 
                  : 'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200'
                }`}
            >
              <tab.icon className="w-4 h-4" />
              {tab.label}
            </button>
          ))}
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-3xl mx-auto p-4 pb-20">
        
        {/* AMIN CONTENT */}
        {activeTab === 'amin' && (
          <div className="animate-in slide-in-from-right-4 duration-300">
            <MindMapNode title="1. Khái Niệm & Phân Loại" color="blue" icon={Info}>
              <SubNode title="Định nghĩa" content="Thay thế nguyên tử H trong NH₃ bằng gốc Hidrocacbon." />
              <SubNode title="Bậc Amin" content="Tính bằng số nguyên tử H bị thay thế (Bậc 1, 2, 3)." highlight="Khác với bậc Ancol!" />
              <SubNode title="Ví dụ" content={<span>CH₃NH₂ (Bậc 1) • (CH₃)₂NH (Bậc 2)</span>} />
            </MindMapNode>

            <MindMapNode title="2. Tính Chất Vật Lý" color="blue" icon={Droplet}>
              <SubNode title="4 chất đầu dãy (Metyl, Etyl...)" content="Khí, mùi khai, tan nhiều, độc." />
              <SubNode title="Anilin (C₆H₅NH₂)" content="Lỏng, không màu (hóa đen khi để lâu), ít tan, rất độc." />
            </MindMapNode>

            <MindMapNode title="3. Tính Chất Hóa Học (Trọng tâm)" color="red" icon={Beaker}>
              <SubNode title="Tính Bazơ" content="Do cặp e tự do trên nguyên tử N." />
              <SubNode title="So sánh lực bazơ" content={<span>Gốc đẩy e (ankyl) &gt; NH₃ &gt; Gốc hút e (phenyl)</span>} highlight="Rất hay thi!" />
              <SubNode title="Chỉ thị màu" content={<span>Amin béo: Quỳ → <span className="text-blue-600 font-bold">Xanh</span>. Anilin: <span className="text-gray-500 font-bold">Không đổi</span>.</span>} />
              <SubNode title="Phản ứng thế nhân thơm" content="Anilin + 3Br₂ → Kết tủa TRẮNG (nhận biết)." highlight="2,4,6-tribromanilin" />
            </MindMapNode>
          </div>
        )}

        {/* AMINO AXIT CONTENT */}
        {activeTab === 'aa' && (
          <div className="animate-in slide-in-from-right-4 duration-300">
            <MindMapNode title="1. Cấu Tạo & Danh Pháp" color="green" icon={Info}>
              <SubNode title="Định nghĩa" content="Hợp chất tạp chức: Nhóm Amino (-NH₂) + Cacboxyl (-COOH)." />
              <SubNode title="Trạng thái" content="Rắn, kết tinh, nhiệt độ nóng chảy cao, dễ tan trong nước (tồn tại dạng ion lưỡng cực)." />
            </MindMapNode>

            <MindMapNode title="2. Năm Amino Axit Cần Nhớ (M)" color="green" icon={Table}>
              <div className="grid grid-cols-2 gap-2 mt-1">
                <div className="bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                  <div className="font-bold text-emerald-600">Glyxin</div>
                  <div className="text-xs text-gray-500">M = 75</div>
                </div>
                <div className="bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                  <div className="font-bold text-emerald-600">Alanin</div>
                  <div className="text-xs text-gray-500">M = 89</div>
                </div>
                <div className="bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                  <div className="font-bold text-emerald-600">Valin</div>
                  <div className="text-xs text-gray-500">M = 117</div>
                </div>
                <div className="bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 shadow-sm text-center border-l-4 border-l-blue-500">
                  <div className="font-bold text-blue-600">Lysin</div>
                  <div className="text-xs text-gray-500">M=146 (Quỳ Xanh)</div>
                </div>
                <div className="bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700 shadow-sm text-center border-l-4 border-l-red-500 col-span-2">
                  <div className="font-bold text-red-600">Axit Glutamic</div>
                  <div className="text-xs text-gray-500">M=147 (Quỳ Đỏ)</div>
                </div>
              </div>
            </MindMapNode>

            <MindMapNode title="3. Tính Chất Hóa Học" color="red" icon={Beaker}>
              <SubNode title="Tính Lưỡng Tính" content="Tác dụng HCl (vào nhóm NH₂) & Tác dụng NaOH (vào nhóm COOH)." />
              <SubNode title="Phản ứng Este hóa" content="Với Ancol (xt khí HCl) tạo este." />
              <SubNode title="Phản ứng Trùng ngưng" content="Tạo Polime (tách nước). Điều kiện: Có OH và H linh động." highlight="Ra Nilon-6, Nilon-7" />
            </MindMapNode>
          </div>
        )}

        {/* PEPTIT PROTEIN CONTENT */}
        {activeTab === 'protein' && (
          <div className="animate-in slide-in-from-right-4 duration-300">
            <MindMapNode title="1. Peptit" color="purple" icon={Layers}>
              <SubNode title="Liên kết Peptit" content="Liên kết -CO-NH- giữa 2 đơn vị α-amino axit." />
              <SubNode title="Phân loại" content="Oligopeptit (2-10 gốc) và Polipeptit (11-50 gốc)." />
              <SubNode title="Phản ứng Thủy phân" content="Hoàn toàn → α-amino axit. Không hoàn toàn → Peptit ngắn hơn." />
              <SubNode title="Phản ứng màu Biure" content={<span>Tác dụng Cu(OH)₂/OH⁻ → Phức màu <span className="text-purple-600 font-bold">TÍM</span>.</span>} highlight="Chỉ Tripeptit trở lên!" />
            </MindMapNode>

            <MindMapNode title="2. Protein" color="purple" icon={Info}>
              <SubNode title="Đặc điểm" content="Polipeptit cao phân tử. Cấu trúc phức tạp." />
              <SubNode title="Đông tụ" content="Khi đun nóng hoặc gặp axit/kiềm/muối (VD: Luộc trứng, riêu cua)." />
              <SubNode title="Phản ứng với HNO₃" content="Tạo kết tủa màu VÀNG." />
            </MindMapNode>
          </div>
        )}

      </main>

      {/* Comparison Modal */}
      {showTable && <ComparisonTable onClose={() => setShowTable(false)} />}
    </div>
  );
};

export default App;

