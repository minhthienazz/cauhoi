<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Soul - 30 Questions to Connect</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        /* Glassmorphism Logic */
        .glass-card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            width: 100%;
            max-width: 800px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh; /* Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ scroll n·ªôi dung b√™n trong */
        }

        /* Scrollbar ƒë·∫πp h∆°n */
        .custom-scroll {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #764ba2 #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #764ba2;
            border-radius: 20px;
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* Option Styling */
        .option-card:hover {
            transform: translateY(-2px);
            border-color: #764ba2;
            background-color: #F3E8FF;
        }
        .option-selected {
            background: linear-gradient(90deg, #764ba2 0%, #667eea 100%) !important;
            color: white !important;
            border-color: #764ba2 !important;
            box-shadow: 0 4px 6px -1px rgba(118, 75, 162, 0.4);
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #764ba2;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="glass-card fade-in relative">
        
        <!-- Decoration Elements -->
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-purple-500 via-pink-500 to-blue-500"></div>

        <!-- === SCREEN 1: WELCOME === -->
        <div id="welcome-screen" class="flex flex-col items-center justify-center p-8 text-center h-full overflow-y-auto">
            <div class="mb-6 p-5 bg-white rounded-full text-purple-600 text-5xl shadow-md">
                <i class="fas fa-brain"></i>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">30 Questions to Connect</h1>
            <p class="text-gray-600 mb-8 max-w-lg mx-auto leading-relaxed">
                M·ªôt h√†nh tr√¨nh t√¢m l√Ω s√¢u s·∫Øc ƒë·ªÉ th·∫•u hi·ªÉu t√≠nh c√°ch, quan ƒëi·ªÉm v√† c·∫£m x√∫c c·ªßa b·∫°n. 
                <br>H√£y tr·∫£ l·ªùi th·∫≠t l√≤ng ƒë·ªÉ k·∫øt n·ªëi th·∫≠t s·ª±.
            </p>
            
            <div class="w-full max-w-sm space-y-5">
                <div class="text-left">
                    <label class="block text-sm font-bold text-gray-700 mb-2">T√™n c·ªßa b·∫°n</label>
                    <input type="text" id="user-name" placeholder="Nh·∫≠p t√™n..." class="w-full px-5 py-4 rounded-xl border border-gray-300 bg-white/80 text-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition">
                </div>

                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-xl text-left text-sm text-blue-800">
                    <p class="font-bold mb-1"><i class="fas fa-info-circle mr-1"></i> Lu·∫≠t ch∆°i:</p>
                    <ul class="list-disc list-inside space-y-1">
                        <li>G·ªìm 30 c√¢u h·ªèi (Tr·∫Øc nghi·ªám & T·ª± lu·∫≠n).</li>
                        <li>T·ª± lu·∫≠n ph·∫£i vi·∫øt tr√™n 4 t·ª´.</li>
                        <li>Th·ªùi gian: 30 ph√∫t.</li>
                    </ul>
                </div>

                <button onclick="startQuiz()" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-gray-800 transform transition hover:-translate-y-1">
                    B·∫Øt ƒë·∫ßu h√†nh tr√¨nh <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- === SCREEN 2: QUIZ === -->
        <div id="quiz-screen" class="hidden flex flex-col h-full relative">
            <!-- Header -->
            <div class="flex-none flex justify-between items-center px-6 py-4 border-b border-gray-100 bg-white/50 backdrop-blur-sm z-20">
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Ng∆∞·ªùi tham gia</span>
                    <span id="display-name" class="font-bold text-gray-800 text-lg truncate max-w-[150px]">Guest</span>
                </div>
                <div class="flex items-center text-purple-700 bg-purple-100 px-4 py-2 rounded-full font-mono font-bold shadow-inner text-sm md:text-base">
                    <i class="far fa-clock mr-2"></i>
                    <span id="timer">30:00</span>
                </div>
            </div>
            
            <!-- Progress -->
            <div class="flex-none w-full bg-gray-200 h-1.5">
                <div id="progress-bar" class="bg-gradient-to-r from-purple-600 to-blue-500 h-1.5 transition-all duration-300 ease-out" style="width: 0%"></div>
            </div>

            <!-- Content Area (Scrollable) -->
            <div class="flex-grow p-6 md:p-8 custom-scroll relative">
                <div class="mb-4 flex items-center justify-between">
                    <span class="text-xs font-bold bg-gray-800 text-white px-3 py-1 rounded-full" id="question-number">C√ÇU 1/30</span>
                    <span class="text-xs font-bold bg-red-100 text-red-600 px-3 py-1 rounded-full hidden animate-pulse" id="error-badge">
                        <i class="fas fa-exclamation-circle mr-1"></i> Ch∆∞a ho√†n th√†nh
                    </span>
                </div>
                
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-3 leading-snug" id="question-text">Loading...</h2>
                <p class="text-gray-500 mb-6 italic text-sm border-l-4 border-purple-300 pl-3" id="question-desc"></p>
                
                <!-- Dynamic Options -->
                <div id="options-area" class="space-y-3 pb-4">
                    <!-- Options injected via JS -->
                </div>
            </div>

            <!-- Footer Navigation -->
            <div class="flex-none p-5 border-t border-gray-100 bg-white/80 backdrop-blur-md flex justify-between items-center z-20">
                <button id="btn-prev" onclick="prevQuestion()" class="px-5 py-2.5 rounded-lg text-gray-500 font-bold hover:bg-gray-100 transition disabled:opacity-30 disabled:cursor-not-allowed">
                    <i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i
                </button>

                <div class="flex gap-2">
                    <button id="btn-next" onclick="nextQuestion()" class="px-6 py-2.5 rounded-lg bg-gray-900 text-white font-bold hover:bg-gray-700 shadow-lg transition flex items-center">
                        Ti·∫øp theo <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                    
                    <button id="btn-submit" onclick="attemptSubmit()" class="hidden px-6 py-2.5 rounded-lg bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold hover:shadow-lg hover:scale-105 transition flex items-center">
                        Ho√†n th√†nh <i class="fas fa-paper-plane ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- === SCREEN 3: SUCCESS === -->
        <div id="success-screen" class="hidden flex flex-col items-center justify-center p-8 text-center h-full">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 text-green-500 text-4xl shadow-md animate-bounce">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3">ƒê√£ g·ª≠i th√†nh c√¥ng!</h2>
            <p class="text-gray-600 mb-8">Nh·ªØng c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n l√† m·ªôt m·∫£nh gh√©p th√∫ v·ªã. Admin s·∫Ω ƒë·ªçc v√† ph·∫£n h·ªìi s·ªõm nh·∫•t.</p>
            <div class="bg-white p-6 rounded-xl w-full max-w-md border border-gray-200 shadow-sm">
                <p class="text-sm text-gray-500 font-medium uppercase tracking-wider mb-2">Tr·∫°ng th√°i tin nh·∫Øn</p>
                <div class="flex items-center justify-center gap-2 text-blue-600 font-bold">
                    <i class="fab fa-telegram-plane"></i> Delivered to Admin
                </div>
            </div>
            <button onclick="location.reload()" class="mt-8 text-purple-600 hover:text-purple-800 text-sm font-bold underline decoration-wavy">L√†m l·∫°i b√†i test</button>
        </div>

        <!-- === SCREEN 4: LOADING === -->
        <div id="loading-screen" class="hidden flex flex-col items-center justify-center absolute inset-0 bg-white/95 backdrop-blur-md z-50">
            <div class="loader mb-6"></div>
            <p class="text-gray-800 font-bold text-lg animate-pulse">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</p>
            <p class="text-gray-500 text-sm mt-2">Vui l√≤ng kh√¥ng t·∫Øt tr√¨nh duy·ªát</p>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- C·∫§U H√åNH ---
        const TELEGRAM_TOKEN = "6452107579:AAHmflV5nkc8aqEz5kVAAveEITVw7tU5GfU";
        const ADMIN_CHAT_ID = "2028093357";

        // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 C√¢u - S·∫Øp x·∫øp logic) ---
        const questions = [
            // --- PART 1: PHONG C√ÅCH S·ªêNG & TH√ìI QUEN (1-7) ---
            { id: 1, type: 'mcq', text: "V√†o ng√†y ngh·ªâ, m·ª©c nƒÉng l∆∞·ª£ng c·ªßa b·∫°n ph·ª•c h·ªìi t·ªët nh·∫•t khi n√†o?", desc: "Introvert vs Extrovert.", options: [{key:'A',val:"·ªû m·ªôt m√¨nh, kh√¥ng gian y√™n tƒ©nh."}, {key:'B',val:"G·∫∑p g·ª° b·∫°n b√® th√¢n thi·∫øt, chill nh·∫π nh√†ng."}, {key:'C',val:"Tham gia ti·ªác t√πng, s·ª± ki·ªán ƒë√¥ng ng∆∞·ªùi."}, {key:'D',val:"V·∫≠n ƒë·ªông th·ªÉ thao ho·∫∑c ƒëi ph∆∞·ª£t."}] },
            { id: 2, type: 'mcq', text: "B·∫°n l√† ki·ªÉu ng∆∞·ªùi c·ªßa bu·ªïi n√†o trong ng√†y?", desc: "ƒê·ªìng h·ªì sinh h·ªçc.", options: [{key:'A',val:"H·ªça mi ban s·ªõm (D·∫≠y s·ªõm, l√†m vi·ªác hi·ªáu qu·∫£ bu·ªïi s√°ng)."}, {key:'B',val:"C√∫ ƒë√™m (Th·ª©c khuya, s√°ng t·∫°o v√†o ban ƒë√™m)."}, {key:'C',val:"Linh ho·∫°t t√πy theo c√¥ng vi·ªác."}, {key:'D',val:"L√∫c n√†o c≈©ng bu·ªìn ng·ªß."}] },
            { id: 3, type: 'mcq', text: "Quan ƒëi·ªÉm c·ªßa b·∫°n v·ªÅ vi·ªác qu·∫£n l√Ω ti·ªÅn b·∫°c?", desc: "Gi√° tr·ªã v·∫≠t ch·∫•t.", options: [{key:'A',val:"Ti·∫øt ki·ªám l√† qu·ªëc s√°ch, lu√¥n d·ª± ph√≤ng."}, {key:'B',val:"L√†m h·∫øt s·ª©c ch∆°i h·∫øt m√¨nh (YOLO)."}, {key:'C',val:"Chi ti√™u c√≥ k·∫ø ho·∫°ch nh∆∞ng s·∫µn s√†ng chi cho tr·∫£i nghi·ªám."}, {key:'D',val:"ƒê∆∞a ng∆∞·ªùi kh√°c gi·ªØ h·ªô cho ch·∫Øc ƒÉn."}] },
            { id: 4, type: 'mcq', text: "G√≥c ph√≤ng/b√†n l√†m vi·ªác c·ªßa b·∫°n hi·ªán t·∫°i tr√¥ng nh∆∞ th·∫ø n√†o?", desc: "M·ª©c ƒë·ªô ngƒÉn n·∫Øp.", options: [{key:'A',val:"R·∫•t g·ªçn g√†ng, m·ªçi th·ª© ƒë√¢u ra ƒë·∫•y."}, {key:'B',val:"H∆°i b·ª´a b·ªôn nh∆∞ng m√¨nh bi·∫øt ƒë·ªì n·∫±m ·ªü ƒë√¢u."}, {key:'C',val:"H·ªón ƒë·ªôn, m√¨nh th√≠ch s·ª± t·ª± do."}, {key:'D',val:"S·∫°ch s·∫Ω ƒë·∫øn m·ª©c √°m ·∫£nh (OCD nh·∫π)."}] },
            { id: 5, type: 'mcq', text: "B·∫°n th√≠ch nu√¥i th√∫ c∆∞ng n√†o?", desc: "Khuynh h∆∞·ªõng t√¨nh c·∫£m.", options: [{key:'A',val:"Ch√≥ (Th√≠ch s·ª± trung th√†nh, qu·∫•n qu√Ωt)."}, {key:'B',val:"M√®o (Th√≠ch s·ª± ƒë·ªôc l·∫≠p, ch·∫£nh ch·ªçe)."}, {key:'C',val:"C·∫£ hai ho·∫∑c lo√†i kh√°c."}, {key:'D',val:"Kh√¥ng nu√¥i (Th√≠ch t·ª± do ho·∫∑c s·ª£ tr√°ch nhi·ªám)."}] },
            { id: 6, type: 'mcq', text: "Khi ƒëi du l·ªãch, phong c√°ch c·ªßa b·∫°n l√† g√¨?", desc: "S·ª± linh ho·∫°t.", options: [{key:'A',val:"L√™n l·ªãch tr√¨nh chi ti·∫øt t·ª´ng gi·ªù."}, {key:'B',val:"Ch·ªâ ƒë·∫∑t v√© v√† ph√≤ng, c√≤n l·∫°i t√πy h·ª©ng."}, {key:'C',val:"Ngh·ªâ d∆∞·ª°ng sang ch·∫£nh (Resort/Hotel x·ªãn)."}, {key:'D',val:"Kh√°m ph√° b·ª•i, tr·∫£i nghi·ªám vƒÉn h√≥a ƒë·ªãa ph∆∞∆°ng."}] },
            { id: 7, type: 'open', text: "M√≥n ƒÉn 'comfort food' (m√≥n t·ªß) khi·∫øn b·∫°n vui l√™n ngay l·∫≠p t·ª©c l√† g√¨?", desc: "S·ªü th√≠ch ƒÉn u·ªëng. (Vi·∫øt > 4 t·ª´)", placeholder: "M√≥n m√¨nh th√≠ch nh·∫•t l√†..." },

            // --- PART 2: GIAO TI·∫æP & X√É H·ªòI (8-14) ---
            { id: 8, type: 'mcq', text: "Khi g·∫∑p m√¢u thu·∫´n/c√£i v√£, ph·∫£n ·ª©ng ƒë·∫ßu ti√™n c·ªßa b·∫°n?", desc: "Gi·∫£i quy·∫øt xung ƒë·ªôt.", options: [{key:'A',val:"Im l·∫∑ng ƒë·ªÉ b√¨nh tƒ©nh l·∫°i."}, {key:'B',val:"Mu·ªën gi·∫£i quy·∫øt, tranh lu·∫≠n cho ra l·∫Ω ngay."}, {key:'C',val:"Nh∆∞·ªùng nh·ªãn, xin l·ªói tr∆∞·ªõc ƒë·ªÉ √™m chuy·ªán."}, {key:'D',val:"B·ªè ƒëi ch·ªó kh√°c ho·∫∑c t√¨m ng∆∞·ªùi ph√¢n x·ª≠."}] },
            { id: 9, type: 'mcq', text: "Trong nh√≥m b·∫°n, b·∫°n th∆∞·ªùng ƒë√≥ng vai tr√≤ g√¨?", desc: "V·ªã tr√≠ x√£ h·ªôi.", options: [{key:'A',val:"Leader - Ng∆∞·ªùi ƒë∆∞a ra k·∫ø ho·∫°ch."}, {key:'B',val:"H·ªÅ ch√∫a - Ng∆∞·ªùi t·∫°o ti·∫øng c∆∞·ªùi."}, {key:'C',val:"Ng∆∞·ªùi l·∫Øng nghe - Ai c≈©ng t√¨m ƒë·∫øn t√¢m s·ª±."}, {key:'D',val:"Ng∆∞·ªùi tr·∫ßm l·∫∑ng - Ch·ªâ quan s√°t v√† ƒëi theo."}] },
            { id: 10, type: 'mcq', text: "B·∫°n c·∫£m th·∫•y th·∫ø n√†o v·ªÅ vi·ªác tr·ªÖ gi·ªù?", desc: "S·ª± t√¥n tr·ªçng th·ªùi gian.", options: [{key:'A',val:"C·ª±c gh√©t, m√¨nh lu√¥n ƒë√∫ng gi·ªù."}, {key:'B',val:"Ch·∫•p nh·∫≠n ƒë∆∞·ª£c n·∫øu tr·ªÖ 5-10 ph√∫t."}, {key:'C',val:"M√¨nh l√† tr√πm 'cao su', hay tr·ªÖ."}, {key:'D',val:"T√πy v√†o t·∫ßm quan tr·ªçng c·ªßa cu·ªôc h·∫πn."}] },
            { id: 11, type: 'mcq', text: "Phong c√°ch nh·∫Øn tin c·ªßa b·∫°n?", desc: "Giao ti·∫øp online.", options: [{key:'A',val:"Rep nhanh nh∆∞ gi√≥, nhi·ªÅu icon."}, {key:'B',val:"Ch·∫≠m r√£i, vi·∫øt c√¢u c√∫ ƒë·∫ßy ƒë·ªß."}, {key:'C',val:"Ng·∫Øn g·ªçn, ƒëi th·∫≥ng v√†o v·∫•n ƒë·ªÅ."}, {key:'D',val:"Seen kh√¥ng rep ho·∫∑c qu√™n rep."}] },
            { id: 12, type: 'open', text: "ƒêi·ªÅu g√¨ ·ªü ng∆∞·ªùi kh√°c khi·∫øn b·∫°n m·∫•t c·∫£m t√¨nh ngay l·∫≠p t·ª©c?", desc: "Gi·ªõi h·∫°n ch·ªãu ƒë·ª±ng. (Vi·∫øt > 4 t·ª´)", placeholder: "M√¨nh c·ª±c gh√©t ki·ªÉu ng∆∞·ªùi..." },
            { id: 13, type: 'mcq', text: "B·∫°n c√≥ d·ªÖ d√†ng tin t∆∞·ªüng ng∆∞·ªùi m·ªõi quen kh√¥ng?", desc: "Ni·ªÅm tin.", options: [{key:'A',val:"C√≥, m√¨nh tin ng∆∞·ªùi cho ƒë·∫øn khi h·ªç l√†m sai."}, {key:'B',val:"Kh√¥ng, c·∫ßn th·ªùi gian d√†i ƒë·ªÉ ch·ª©ng minh."}, {key:'C',val:"T√πy v√†o tr·ª±c gi√°c l√∫c ƒë√≥."}, {key:'D',val:"M√¨nh lu√¥n gi·ªØ kho·∫£ng c√°ch an to√†n."}] },
            { id: 14, type: 'mcq', text: "B·∫°n th√≠ch v√≤ng tr√≤n quan h·ªá nh∆∞ th·∫ø n√†o?", desc: "Ch·∫•t l∆∞·ª£ng vs S·ªë l∆∞·ª£ng.", options: [{key:'A',val:"√çt b·∫°n b√® nh∆∞ng c·ª±c k·ª≥ ch·∫•t l∆∞·ª£ng."}, {key:'B',val:"Qu·∫£ng giao, quen bi·∫øt r·ªông r√£i."}, {key:'C',val:"M·ªôt nh√≥m nh·ªè ch∆°i th√¢n t·ª´ l√¢u."}, {key:'D',val:"ƒê·ªôc l·∫≠p, kh√¥ng qu√° quan tr·ªçng b·∫°n b√®."}] },

            // --- PART 3: T√åNH Y√äU & C·∫¢M X√öC (15-22) ---
            { id: 15, type: 'mcq', text: "Ng√¥n ng·ªØ t√¨nh y√™u ch√≠nh c·ªßa b·∫°n l√† g√¨?", desc: "C√°ch b·∫°n mu·ªën ƒë∆∞·ª£c y√™u.", options: [{key:'A',val:"L·ªùi kh·∫≥ng ƒë·ªãnh (Khen ng·ª£i, ng·ªçt ng√†o)."}, {key:'B',val:"Th·ªùi gian ch·∫•t l∆∞·ª£ng (·ªû b√™n nhau)."}, {key:'C',val:"C·ª≠ ch·ªâ chƒÉm s√≥c (N·∫•u ƒÉn, gi√∫p ƒë·ª°)."}, {key:'D',val:"Ti·∫øp x√∫c c∆° th·ªÉ (√îm, n·∫Øm tay)."}, {key:'E',val:"Qu√† t·∫∑ng."}] },
            { id: 16, type: 'mcq', text: "M·ª©c ƒë·ªô ghen tu√¥ng c·ªßa b·∫°n?", desc: "S·ª± chi·∫øm h·ªØu.", options: [{key:'A',val:"Ghen ng·∫ßm, kh√¥ng n√≥i ra nh∆∞ng kh√≥ ch·ªãu."}, {key:'B',val:"Ghen ra m·∫∑t, c·∫ßn gi·∫£i th√≠ch ngay."}, {key:'C',val:"√çt ghen, tin t∆∞·ªüng ƒë·ªëi ph∆∞∆°ng."}, {key:'D',val:"Th√≠ch ch·ªçc cho ƒë·ªëi ph∆∞∆°ng ghen."}] },
            { id: 17, type: 'mcq', text: "Trong t√¨nh y√™u, b·∫°n l√† ng∆∞·ªùi...", desc: "T·ªëc ƒë·ªô t√¨nh c·∫£m.", options: [{key:'A',val:"Y√™u t·ª´ c√°i nh√¨n ƒë·∫ßu ti√™n (Nhanh)."}, {key:'B',val:"M∆∞a d·∫ßm th·∫•m l√¢u (Ch·∫≠m)."}, {key:'C',val:"L√Ω tr√≠, c√¢n nh·∫Øc k·ªπ m·ªõi y√™u."}, {key:'D',val:"T√πy duy√™n s·ªë."}] },
            { id: 18, type: 'mcq', text: "N·∫øu ƒë·ªëi ph∆∞∆°ng l√†m sai, b·∫°n c√≥ d·ªÖ tha th·ª© kh√¥ng?", desc: "S·ª± bao dung.", options: [{key:'A',val:"D·ªÖ m·ªÅm l√≤ng n·∫øu h·ªç xin l·ªói ch√¢n th√†nh."}, {key:'B',val:"Kh√≥, m√¨nh nh·ªõ dai v√† hay nh·∫Øc l·∫°i."}, {key:'C',val:"Tha th·ª© nh∆∞ng kh√¥ng bao gi·ªù qu√™n."}, {key:'D',val:"T√πy m·ª©c ƒë·ªô l·ªói l·∫ßm."}] },
            { id: 19, type: 'open', text: "M·ªôt ph·∫©m ch·∫•t quan tr·ªçng nh·∫•t b·∫°n t√¨m ki·∫øm ·ªü ng∆∞·ªùi y√™u?", desc: "Ti√™u chu·∫©n c·ªët l√µi. (Vi·∫øt > 4 t·ª´)", placeholder: "ƒê·ªëi v·ªõi m√¨nh, quan tr·ªçng nh·∫•t l√†..." },
            { id: 20, type: 'mcq', text: "B·∫°n c√≥ s·∫µn s√†ng c√¥ng khai m·ªëi quan h·ªá l√™n m·∫°ng x√£ h·ªôi?", desc: "S·ª± ri√™ng t∆∞.", options: [{key:'A',val:"C√≥, ƒë√°nh d·∫•u ch·ªß quy·ªÅn ngay."}, {key:'B',val:"Th·ªânh tho·∫£ng, v√†o d·ªãp ƒë·∫∑c bi·ªát."}, {key:'C',val:"Kh√¥ng, t√¨nh y√™u l√† chuy·ªán hai ng∆∞·ªùi."}, {key:'D',val:"Ch·ªâ c√¥ng khai khi ƒë√£ c∆∞·ªõi/ƒë√≠nh h√¥n."}] },
            { id: 21, type: 'open', text: "N·ªói s·ª£ l·ªõn nh·∫•t c·ªßa b·∫°n trong t√¨nh y√™u l√† g√¨?", desc: "S·ª± t·ªïn th∆∞∆°ng. (Vi·∫øt > 4 t·ª´)", placeholder: "M√¨nh s·ª£ nh·∫•t c·∫£m gi√°c..." },
            { id: 22, type: 'mcq', text: "Sau khi chia tay, b·∫°n c√≥ l√†m b·∫°n v·ªõi ng∆∞·ªùi y√™u c≈© kh√¥ng?", desc: "X·ª≠ l√Ω qu√° kh·ª©.", options: [{key:'A',val:"Tuy·ªát ƒë·ªëi kh√¥ng, c·∫Øt ƒë·ª©t li√™n l·∫°c."}, {key:'B',val:"C√≥ th·ªÉ, n·∫øu chia tay trong h√≤a b√¨nh."}, {key:'C',val:"L√†m b·∫°n x√£ giao b√¨nh th∆∞·ªùng."}, {key:'D',val:"V·∫´n quan t√¢m nh∆∞ng √¢m th·∫ßm."}] },

            // --- PART 4: CHI·ªÄU S√ÇU & QUAN ƒêI·ªÇM (23-30) ---
            { id: 23, type: 'mcq', text: "B·∫°n quy·∫øt ƒë·ªãnh v·∫•n ƒë·ªÅ quan tr·ªçng d·ª±a tr√™n?", desc: "L√Ω tr√≠ vs C·∫£m x√∫c.", options: [{key:'A',val:"Logic, s·ªë li·ªáu v√† th·ª±c t·∫ø."}, {key:'B',val:"Tr·ª±c gi√°c v√† c·∫£m x√∫c m√°ch b·∫£o."}, {key:'C',val:"L·ªùi khuy√™n c·ªßa gia ƒë√¨nh/b·∫°n b√®."}, {key:'D',val:"Tung ƒë·ªìng xu (May r·ªßi)."}] },
            { id: 24, type: 'open', text: "N·∫øu c√≥ th·ªÉ thay ƒë·ªïi m·ªôt ƒëi·ªÅu trong qu√° kh·ª©, b·∫°n s·∫Ω thay ƒë·ªïi g√¨?", desc: "S·ª± h·ªëi ti·∫øc. (Vi·∫øt > 4 t·ª´)", placeholder: "M√¨nh ∆∞·ªõc m√¨nh ƒë√£..." },
            { id: 25, type: 'mcq', text: "B·∫°n c√≥ ph·∫£i l√† ng∆∞·ªùi hay suy nghƒ© qu√° nhi·ªÅu (Overthinking)?", desc: "T√¢m l√Ω.", options: [{key:'A',val:"R·∫•t nhi·ªÅu, hay suy di·ªÖn lung tung."}, {key:'B',val:"Th·ªânh tho·∫£ng, khi g·∫∑p chuy·ªán bu·ªìn."}, {key:'C',val:"Hi·∫øm khi, m√¨nh s·ªëng v√¥ t∆∞."}, {key:'D',val:"Ch·ªâ suy nghƒ© v·ªÅ c√¥ng vi·ªác/ti·ªÅn b·∫°c."}] },
            { id: 26, type: 'open', text: "Ba t·ª´ m√¥ t·∫£ ch√≠nh x√°c nh·∫•t v·ªÅ con ng∆∞·ªùi th·∫≠t c·ªßa b·∫°n?", desc: "T·ª± nh·∫≠n th·ª©c. (Vi·∫øt > 4 t·ª´)", placeholder: "V√≠ d·ª•: Ch√¢n th√†nh, n√≥ng t√≠nh, ..." },
            { id: 27, type: 'mcq', text: "∆Øu ti√™n s·ªë 1 hi·ªán t·∫°i c·ªßa b·∫°n l√† g√¨?", desc: "M·ª•c ti√™u s·ªëng.", options: [{key:'A',val:"S·ª± nghi·ªáp v√† t√†i ch√≠nh."}, {key:'B',val:"T√¨m ki·∫øm t√¨nh y√™u ƒë√≠ch th·ª±c."}, {key:'C',val:"Gia ƒë√¨nh v√† s·ª©c kh·ªèe."}, {key:'D',val:"T·ª± do v√† tr·∫£i nghi·ªám b·∫£n th√¢n."}] },
            { id: 28, type: 'mcq', text: "B·∫°n c√≥ tin v√†o ƒë·ªãnh m·ªánh/duy√™n s·ªë kh√¥ng?", desc: "Th·∫ø gi·ªõi quan.", options: [{key:'A',val:"Tin tuy·ªát ƒë·ªëi, m·ªçi vi·ªác do tr·ªùi ƒë·ªãnh."}, {key:'B',val:"Tin m·ªôt ph·∫ßn, nh∆∞ng n·ªó l·ª±c v·∫´n h∆°n."}, {key:'C',val:"Kh√¥ng, v·∫≠n m·ªánh trong tay m√¨nh."}, {key:'D',val:"Kh√¥ng quan t√¢m l·∫Øm."}] },
            { id: 29, type: 'open', text: "Ch·ªß ƒë·ªÅ n√†o b·∫°n c√≥ th·ªÉ n√≥i say s∆∞a c·∫£ ng√†y kh√¥ng ch√°n?", desc: "ƒêam m√™. (Vi·∫øt > 4 t·ª´)", placeholder: "M√¨nh r·∫•t th√≠ch n√≥i v·ªÅ..." },
            { id: 30, type: 'open', text: "L·ªùi nh·∫Øn cu·ªëi c√πng b·∫°n mu·ªën g·ª≠i ƒë·∫øn ng∆∞·ªùi ƒë·ªçc k·∫øt qu·∫£ n√†y?", desc: "Th√¥ng ƒëi·ªáp. (Vi·∫øt > 4 t·ª´)", placeholder: "M√¨nh hy v·ªçng..." }
        ];

        // --- STATE VARIABLES ---
        let currentStep = 0;
        let userAnswers = {};
        let userName = "";
        let timeLeft = 30 * 60; // 30 minutes
        let timerInterval;

        // --- DOM ELEMENTS ---
        const welcomeScreen = document.getElementById('welcome-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const successScreen = document.getElementById('success-screen');
        const loadingScreen = document.getElementById('loading-screen');
        
        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const questionDesc = document.getElementById('question-desc');
        const optionsArea = document.getElementById('options-area');
        const errorBadge = document.getElementById('error-badge');
        
        const btnNext = document.getElementById('btn-next');
        const btnPrev = document.getElementById('btn-prev');
        const btnSubmit = document.getElementById('btn-submit');
        const progressBar = document.getElementById('progress-bar');
        const timerDisplay = document.getElementById('timer');

        // --- FUNCTIONS ---

        function startQuiz() {
            const nameInput = document.getElementById('user-name').value.trim();
            if (!nameInput) {
                alert("Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n nh√©!");
                return;
            }
            userName = nameInput;
            document.getElementById('display-name').textContent = userName;

            welcomeScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            quizScreen.classList.add('flex');
            
            renderQuestion();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if(timeLeft < 300) { // 5 mins left warning
                    timerDisplay.parentElement.classList.replace('bg-purple-100', 'bg-red-100');
                    timerDisplay.parentElement.classList.replace('text-purple-700', 'text-red-700');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("ƒê√£ h·∫øt gi·ªù! H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông n·ªôp b√†i.");
                    submitQuiz();
                }
            }, 1000);
        }

        function renderQuestion() {
            const q = questions[currentStep];
            
            // UI Update
            questionNumber.textContent = `C√ÇU ${currentStep + 1}/${questions.length}`;
            questionText.textContent = q.text;
            questionDesc.textContent = q.desc || "";
            errorBadge.classList.add('hidden');

            const progress = ((currentStep) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;

            optionsArea.innerHTML = '';

            // Animation classes
            const animClass = 'fade-in';
            questionText.classList.remove(animClass);
            void questionText.offsetWidth; // Trigger reflow
            questionText.classList.add(animClass);

            if (q.type === 'mcq') {
                q.options.forEach(opt => {
                    const isSelected = userAnswers[q.id] === opt.key;
                    const btn = document.createElement('div');
                    btn.className = `option-card border rounded-xl p-4 md:p-5 cursor-pointer flex items-start gap-4 transition-all duration-200 ${isSelected ? 'option-selected' : 'bg-white border-gray-200 text-gray-700'}`;
                    btn.onclick = () => selectOption(q.id, opt.key);
                    
                    btn.innerHTML = `
                        <div class="flex-shrink-0 w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm mt-0.5 ${isSelected ? 'border-white text-white' : 'border-purple-300 text-purple-500'}">
                            ${opt.key}
                        </div>
                        <span class="text-base font-medium leading-relaxed">${opt.val}</span>
                    `;
                    optionsArea.appendChild(btn);
                });
            } else if (q.type === 'open') {
                const wrapper = document.createElement('div');
                wrapper.className = "relative";
                
                const textarea = document.createElement('textarea');
                textarea.className = "w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 bg-white/80 resize-none h-40 text-gray-800 text-base shadow-inner transition-all";
                textarea.placeholder = q.placeholder || "Vi·∫øt c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n...";
                textarea.value = userAnswers[q.id] || "";
                
                textarea.addEventListener('input', (e) => {
                    userAnswers[q.id] = e.target.value;
                    if(validateCurrentAnswer(true)) errorBadge.classList.add('hidden');
                });

                wrapper.appendChild(textarea);
                
                const hint = document.createElement('div');
                hint.className = "flex justify-end mt-2";
                hint.innerHTML = `<span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">Y√™u c·∫ßu: > 4 t·ª´</span>`;
                wrapper.appendChild(hint);
                
                optionsArea.appendChild(wrapper);
            }

            // Buttons
            btnPrev.disabled = currentStep === 0;
            if (currentStep === questions.length - 1) {
                btnNext.classList.add('hidden');
                btnSubmit.classList.remove('hidden');
            } else {
                btnNext.classList.remove('hidden');
                btnSubmit.classList.add('hidden');
            }
            
            // Auto scroll to top of questions area
            document.querySelector('.custom-scroll').scrollTop = 0;
        }

        function selectOption(qId, key) {
            userAnswers[qId] = key;
            renderQuestion();
        }

        function validateCurrentAnswer(silent = false) {
            const q = questions[currentStep];
            const ans = userAnswers[q.id];

            if (!ans || (typeof ans === 'string' && ans.trim() === "")) {
                if(!silent) showError("Vui l√≤ng ch·ªçn ƒë√°p √°n!");
                return false;
            }

            if (q.type === 'open') {
                const wordCount = ans.trim().split(/\s+/).length;
                if (wordCount < 4) {
                    if(!silent) showError("C√¢u tr·∫£ l·ªùi qu√° ng·∫Øn (c·∫ßn > 3 t·ª´).");
                    return false;
                }
            }
            return true;
        }

        function showError(msg) {
            errorBadge.classList.remove('hidden');
            errorBadge.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i> ${msg}`;
            
            const container = document.getElementById('options-area');
            container.classList.remove('shake');
            void container.offsetWidth; 
            container.classList.add('shake');
        }

        function nextQuestion() {
            if (validateCurrentAnswer()) {
                currentStep++;
                renderQuestion();
            }
        }

        function prevQuestion() {
            if (currentStep > 0) {
                currentStep--;
                renderQuestion();
            }
        }

        function attemptSubmit() {
            if (validateCurrentAnswer()) {
                if(confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i ch·ª©?")) {
                    submitQuiz();
                }
            }
        }

        async function submitQuiz() {
            clearInterval(timerInterval);
            quizScreen.classList.add('hidden');
            loadingScreen.classList.remove('hidden');
            loadingScreen.classList.add('flex');

            // Build Message
            let message = `üìù <b>K·∫æT QU·∫¢: 30 QUESTIONS</b>\n`;
            message += `üë§ <b>T√™n:</b> ${userName}\n`;
            message += `‚è± <b>D∆∞:</b> ${Math.floor(timeLeft / 60)}p ${timeLeft % 60}s\n`;
            message += `------------------------------\n`;

            questions.forEach((q, index) => {
                const rawAns = userAnswers[q.id];
                let displayAns = "<i>(B·ªè tr·ªëng)</i>";

                if (rawAns) {
                    if (q.type === 'mcq') {
                        const opt = q.options.find(o => o.key === rawAns);
                        displayAns = opt ? `<b>[${opt.key}]</b> ${opt.val}` : rawAns;
                    } else {
                        displayAns = `‚úçÔ∏è <i>"${rawAns}"</i>`;
                    }
                }
                message += `<b>C${index + 1}:</b> ${q.text}\n${displayAns}\n\n`;
            });

            // Send Telegram
            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: ADMIN_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });

                const data = await response.json();
                
                loadingScreen.classList.add('hidden');
                if (data.ok) {
                    successScreen.classList.remove('hidden');
                    successScreen.classList.add('flex');
                } else {
                    alert("L·ªói g·ª≠i tin: " + data.description);
                    quizScreen.classList.remove('hidden');
                }
            } catch (error) {
                console.error(error);
                alert("L·ªói k·∫øt n·ªëi m·∫°ng!");
                loadingScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>

