<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Deep Soul - Final Version</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* RESET & BASE STYLES */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0; padding: 0;
            color: #333;
        }

        /* APP CONTAINER */
        .app-container {
            background: rgba(255, 255, 255, 0.96);
            width: 100%;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 500px;
                height: 90vh;
                max-height: 850px;
                border-radius: 24px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            }
        }

        /* SCROLL AREA */
        .scroll-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 24px 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* FOOTER FIXED */
        .footer-fixed {
            flex-shrink: 0;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid #eee;
            padding: 16px 20px;
            padding-bottom: calc(16px + env(safe-area-inset-bottom));
            backdrop-filter: blur(5px);
            z-index: 50;
        }

        /* STYLING */
        .option-card {
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            background: white;
        }
        .option-card:active { transform: scale(0.98); background-color: #f8fafc; }
        
        .option-selected {
            background: #2c5364 !important;
            color: white !important;
            border-color: #2c5364 !important;
            box-shadow: 0 4px 10px rgba(44, 83, 100, 0.3);
        }
        
        .circle-check { border-color: #cbd5e1; }
        .option-selected .circle-check { border-color: white; background: rgba(255,255,255,0.2); }

        /* LOADING */
        .loader {
            width: 32px; height: 32px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #2c5364;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Custom Select Arrow */
        .custom-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='gray' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- === SCREEN 1: WELCOME === -->
        <div id="welcome-screen" class="absolute inset-0 z-50 bg-white flex flex-col h-full">
            <div class="scroll-content flex flex-col items-center justify-center text-center">
                <div class="w-20 h-20 bg-gradient-to-br from-gray-800 to-black rounded-2xl flex items-center justify-center mb-6 shadow-xl rotate-3">
                    <i class="fas fa-feather-alt text-3xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2 tracking-tight">H·ªì S∆° T√¢m L√Ω</h1>
                <p class="text-gray-500 mb-6 px-4 text-sm leading-relaxed">
                    Kh√°m ph√° g√≥c khu·∫•t t√¢m h·ªìn qua 30 c√¢u h·ªèi chuy√™n s√¢u.
                </p>
                
                <div class="w-full space-y-4 text-left">
                    <!-- T√™n -->
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1 tracking-wider">H·ªç t√™n (B·∫Øt bu·ªôc)</label>
                        <div class="relative mt-1">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-gray-400">
                                <i class="fas fa-user"></i>
                            </span>
                            <input type="text" id="user-name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." class="w-full pl-10 pr-4 py-3.5 rounded-xl border border-gray-200 bg-gray-50 text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-gray-800 focus:bg-white transition-all">
                        </div>
                    </div>

                    <!-- Li√™n h·ªá -->
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase ml-1 tracking-wider flex justify-between">
                            <span>Li√™n h·ªá (Kh√¥ng b·∫Øt bu·ªôc)</span>
                            <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded text-gray-500">T√πy ch·ªçn</span>
                        </label>
                        <div class="mt-1 flex gap-2">
                            <div class="relative w-1/3 min-w-[110px]">
                                <select id="contact-type" class="custom-select w-full pl-3 pr-8 py-3.5 rounded-xl border border-gray-200 bg-gray-50 text-sm font-semibold text-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-800 transition-all cursor-pointer">
                                    <option value="Facebook">Facebook</option>
                                    <option value="Zalo">Zalo</option>
                                    <option value="SƒêT">SƒêT</option>
                                    <option value="Gmail">Gmail</option>
                                </select>
                            </div>
                            <div class="relative flex-1">
                                <input type="text" id="contact-value" placeholder="Nh·∫≠p link ho·∫∑c s·ªë..." class="w-full px-4 py-3.5 rounded-xl border border-gray-200 bg-gray-50 text-gray-900 text-sm focus:outline-none focus:ring-2 focus:ring-gray-800 focus:bg-white transition-all">
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-xs text-gray-500 bg-gray-50 p-4 rounded-xl border border-gray-100 space-y-2 mt-4">
                        <p class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> 20 Tr·∫Øc nghi·ªám & 10 T·ª± lu·∫≠n</p>
                        <p class="flex items-center gap-2 font-bold text-gray-800"><i class="fas fa-clock"></i> Th·ªùi gian: 30 Ph√∫t</p>
                    </div>
                </div>
            </div>

            <div class="footer-fixed w-full">
                <button onclick="startQuiz()" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 text-sm uppercase tracking-wider">
                    B·∫Øt ƒë·∫ßu ngay <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- === SCREEN 2: QUIZ === -->
        <div id="quiz-screen" class="hidden flex flex-col h-full relative">
            <div class="flex-shrink-0 px-5 py-4 bg-white/90 backdrop-blur-md border-b border-gray-100 flex justify-between items-center z-10">
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">·ª®ng vi√™n</span>
                    <span id="display-name" class="text-sm font-bold text-gray-900 truncate max-w-[120px]">User</span>
                </div>
                <div class="px-3 py-1.5 bg-gray-100 rounded-lg flex items-center gap-2 border border-gray-200">
                    <i class="far fa-clock text-xs text-gray-500"></i>
                    <span id="timer" class="text-sm font-mono font-bold text-gray-800">30:00</span>
                </div>
            </div>

            <div class="w-full bg-gray-100 h-1 flex-shrink-0">
                <div id="progress-bar" class="bg-gray-800 h-1 transition-all duration-300" style="width: 0%"></div>
            </div>

            <div class="scroll-content" id="scroll-container">
                <div class="mb-5">
                    <div class="flex justify-between items-end mb-2">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-bold rounded uppercase tracking-wider" id="part-label">PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM</span>
                        <span class="text-xs font-bold text-gray-400" id="question-number">1/30</span>
                    </div>
                    <h2 class="text-lg font-bold text-gray-900 leading-snug mb-2" id="question-text">Loading...</h2>
                    <p class="text-sm text-gray-500 italic" id="question-desc"></p>
                </div>

                <div id="error-badge" class="hidden mb-4 p-3 bg-red-50 text-red-600 text-xs font-bold rounded-lg border border-red-100 animate-pulse flex items-center gap-2">
                    <i class="fas fa-exclamation-circle"></i> VUI L√íNG TR·∫¢ L·ªúI ƒê·ªÇ TI·∫æP T·ª§C
                </div>

                <div id="options-area" class="space-y-3 pb-8"></div>
            </div>

            <div class="footer-fixed flex gap-3">
                <button id="btn-prev" onclick="prevQuestion()" class="w-14 flex-shrink-0 h-12 rounded-xl bg-gray-100 text-gray-500 flex items-center justify-center disabled:opacity-30 transition-colors">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button id="btn-next" onclick="nextQuestion()" class="flex-1 h-12 rounded-xl bg-gray-900 text-white font-bold shadow-md flex items-center justify-center gap-2 active:bg-gray-800 transition-colors text-sm uppercase tracking-wide">
                    Ti·∫øp theo
                </button>
                <button id="btn-submit" onclick="attemptSubmit()" class="hidden flex-1 h-12 rounded-xl bg-gray-900 text-white font-bold shadow-md flex items-center justify-center gap-2 active:bg-gray-800 transition-colors text-sm uppercase tracking-wide">
                    Ho√†n t·∫•t & G·ª≠i
                </button>
            </div>
        </div>

        <!-- === SCREEN 3: SUCCESS === -->
        <div id="success-screen" class="hidden absolute inset-0 z-50 bg-white flex-col items-center justify-center p-8 text-center h-full">
            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mb-6 text-green-600 text-2xl shadow-sm border border-green-100">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-900 mb-2">ƒê√£ nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£</h2>
            <p class="text-gray-500 mb-8 text-sm px-4">C·∫£m ∆°n b·∫°n ƒë√£ chia s·∫ª. Th√¥ng tin ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒëi an to√†n.</p>
            <div class="w-full bg-gray-50 rounded-xl p-4 mb-8 border border-gray-100">
                <div class="flex justify-between text-xs uppercase tracking-wide mb-1">
                    <span class="text-gray-400">Tr·∫°ng th√°i</span>
                    <span class="font-bold text-gray-800">ƒê√£ g·ª≠i Admin</span>
                </div>
            </div>
            <button onclick="location.reload()" class="text-gray-400 text-xs font-bold uppercase tracking-widest hover:text-gray-800 py-4">L√†m l·∫°i b√†i test</button>
        </div>

        <!-- === SCREEN 4: LOADING === -->
        <div id="loading-screen" class="hidden absolute inset-0 z-[60] bg-white/95 backdrop-blur-sm flex-col items-center justify-center">
            <div class="loader mb-4"></div>
            <p class="text-xs font-bold text-gray-500 uppercase tracking-widest animate-pulse">ƒêang g·ª≠i d·ªØ li·ªáu...</p>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- C·∫§U H√åNH QUAN TR·ªåNG ---
        // B·∫†N PH·∫¢I THAY M√É TOKEN M·ªöI V√ÄO D√íNG D∆Ø·ªöI ƒê√ÇY TH√å M·ªöI H·∫æT L·ªñI UNAUTHORIZED
        const TELEGRAM_TOKEN = "6452107579:AAHD9JfgCbnzN8c2s8mBq9beyTXA7plmnIQ"; 
        const ADMIN_CHAT_ID = "2028093357";

        // === B·ªò C√ÇU H·ªéI (30 C√ÇU) ===
        const questions = [
            // --- PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM ---
            { id: 1, type: 'mcq', text: "Trong m·ªôt bu·ªïi ti·ªác ƒë√¥ng ng∆∞·ªùi, b·∫°n th∆∞·ªùng:", options: [{k:'A', v:"L√† t√¢m ƒëi·ªÉm, ch·ªß ƒë·ªông b·∫Øt chuy·ªán."}, {k:'B', v:"Ch·ªâ tr√≤ chuy·ªán s√¢u v·ªõi 1-2 ng∆∞·ªùi b·∫°n th√¢n."}, {k:'C', v:"Quan s√°t t·ª´ xa v√† ch·ªâ n√≥i khi c·∫ßn thi·∫øt."}, {k:'D', v:"C·∫£m th·∫•y ki·ªát s·ª©c v√† t√¨m c√°ch v·ªÅ s·ªõm."}] },
            { id: 2, type: 'mcq', text: "Khi g·∫∑p m·ªôt v·∫•n ƒë·ªÅ h√≥c b√∫a t·∫°i n∆°i l√†m vi·ªác/h·ªçc t·∫≠p:", options: [{k:'A', v:"T√¨m ng∆∞·ªùi h·ªó tr·ª£ ho·∫∑c h·ªèi √Ω ki·∫øn t·∫≠p th·ªÉ."}, {k:'B', v:"T·ª± m√¨nh m√†y m√≤, ph√¢n t√≠ch tr∆∞·ªõc."}, {k:'C', v:"C·∫£m th·∫•y lo l·∫Øng, s·ª£ m√¨nh s·∫Ω l√†m sai."}, {k:'D', v:"B·ªè qua n√≥ v√† l√†m vi·ªác kh√°c d·ªÖ h∆°n."}] },
            { id: 3, type: 'mcq', text: "Quan ƒëi·ªÉm v·ªÅ quy t·∫Øc v√† lu·∫≠t l·ªá?", options: [{k:'A', v:"C·∫ßn thi·∫øt, ph·∫£i tu√¢n th·ªß tuy·ªát ƒë·ªëi."}, {k:'B', v:"L√† kim ch·ªâ nam, nh∆∞ng c√≥ th·ªÉ linh ho·∫°t."}, {k:'C', v:"K√¨m h√£m s·ª± s√°ng t·∫°o v√† t·ª± do c√° nh√¢n."}, {k:'D', v:"Kh√¥ng ƒë·ªÉ √Ω l·∫Øm tr·ª´ khi b·ªã nh·∫Øc nh·ªü."}] },
            { id: 4, type: 'mcq', text: "Khi b·∫°n than v√£n v·ªÅ c√πng m·ªôt v·∫•n ƒë·ªÅ l·∫ßn th·ª© 10, b·∫°n s·∫Ω:", options: [{k:'A', v:"Th·∫≥ng th·∫Øn ch·ªâ ra l·ªói sai c·ªßa h·ªç."}, {k:'B', v:"V·∫´n ki√™n nh·∫´n l·∫Øng nghe v√† an ·ªßi."}, {k:'C', v:"ƒê∆∞a ra gi·∫£i ph√°p logic d·ª©t ƒëi·ªÉm."}, {k:'D', v:"L·∫£ng sang chuy·ªán kh√°c ho·∫∑c gi·∫£ v·ªù b·∫≠n."}] },
            { id: 5, type: 'mcq', text: "K·ª≥ ngh·ªâ l√Ω t∆∞·ªüng c·ªßa b·∫°n?", options: [{k:'A', v:"Phi√™u l∆∞u, m·∫°o hi·ªÉm, kh√°m ph√°."}, {k:'B', v:"Ngh·ªâ d∆∞·ª°ng resort 5 sao, th∆∞ gi√£n."}, {k:'C', v:"Chuy·∫øn ƒëi vƒÉn h√≥a, l·ªãch s·ª≠."}, {k:'D', v:"·ªû nh√†, t·∫Øt ƒëi·ªán tho·∫°i, t·∫≠n h∆∞·ªüng m·ªôt m√¨nh."}] },
            { id: 6, type: 'mcq', text: "C∆° s·ªü ƒë∆∞a ra quy·∫øt ƒë·ªãnh quan tr·ªçng?", options: [{k:'A', v:"Tr·ª±c gi√°c m√°ch b·∫£o (Linh t√≠nh)."}, {k:'B', v:"Ph√¢n t√≠ch s·ªë li·ªáu, th·ª±c t·∫ø (Logic)."}, {k:'C', v:"L·ªùi khuy√™n c·ªßa ng∆∞·ªùi c√≥ kinh nghi·ªám."}, {k:'D', v:"C·∫£m x√∫c v√† h·ª©ng th√∫ l√∫c ƒë√≥."}] },
            { id: 7, type: 'mcq', text: "B·∫°n th·∫•y m√¨nh l√† ng∆∞·ªùi:", options: [{k:'A', v:"S·ªëng cho hi·ªán t·∫°i, mai t√≠nh sau."}, {k:'B', v:"Lu√¥n c√≥ k·∫ø ho·∫°ch d√†i h·∫°n r√µ r√†ng."}, {k:'C', v:"Hay ho√†i ni·ªám v√† ti·∫øc nu·ªëi qu√° kh·ª©."}, {k:'D', v:"M∆° m·ªông t∆∞∆°ng lai nh∆∞ng √≠t h√†nh ƒë·ªông."}] },
            { id: 8, type: 'mcq', text: "M·ª•c ti√™u trong tranh lu·∫≠n?", options: [{k:'A', v:"Ch·ª©ng minh m√¨nh ƒë√∫ng v√† th·∫Øng."}, {k:'B', v:"T√¨m ra ch√¢n l√Ω, kh√¥ng quan tr·ªçng ai ƒë√∫ng."}, {k:'C', v:"Gi·ªØ h√≤a kh√≠, s·∫µn s√†ng nh∆∞·ªùng nh·ªãn."}, {k:'D', v:"Thuy·∫øt ph·ª•c nh·∫π nh√†ng ƒë·ªÉ h·ªç hi·ªÉu."}] },
            { id: 9, type: 'mcq', text: "Suy nghƒ© khi th·∫•y ng∆∞·ªùi ƒÉn xin?", options: [{k:'A', v:"H·ªç kh√≥ khƒÉn, n√™n cho ch√∫t g√¨ ƒë√≥."}, {k:'B', v:"T·∫°i sao kh√¥ng ƒëi l√†m? X√£ h·ªôi c·∫ßn ch√≠nh s√°ch."}, {k:'C', v:"C√≥ khi n√†o l√† l·ª´a ƒë·∫£o kh√¥ng?"}, {k:'D', v:"L∆∞·ªõt qua v√† kh√¥ng ƒë·ªÉ t√¢m l·∫Øm."}] },
            { id: 10, type: 'mcq', text: "Kh√¥ng gian l√†m vi·ªác c·ªßa b·∫°n?", options: [{k:'A', v:"R·∫•t g·ªçn g√†ng, ƒë√¢u ra ƒë√≥."}, {k:'B', v:"H∆°i l·ªôn x·ªôn nh∆∞ng bi·∫øt ƒë·ªì ·ªü ƒë√¢u."}, {k:'C', v:"B·ª´a b·ªôn, hay m·∫•t ƒë·ªì."}, {k:'D', v:"T·ªëi gi·∫£n, c·ª±c √≠t ƒë·ªì ƒë·∫°c."}] },
            { id: 11, type: 'mcq', text: "N·∫øu tr√∫ng s·ªë 10 t·ª∑, b·∫°n l√†m g√¨ ƒë·∫ßu ti√™n?", options: [{k:'A', v:"Mua nh√†, xe, ƒë·ªì xa x·ªâ."}, {k:'B', v:"G·ª≠i ng√¢n h√†ng/ƒë·∫ßu t∆∞."}, {k:'C', v:"Chia s·∫ª gia ƒë√¨nh, t·ª´ thi·ªán."}, {k:'D', v:"B·ªè vi·ªác, ƒëi du l·ªãch v√≤ng quanh th·∫ø gi·ªõi."}] },
            { id: 12, type: 'mcq', text: "N·ªói s·ª£ l·ªõn nh·∫•t?", options: [{k:'A', v:"Th·∫•t b·∫°i, b·ªã coi th∆∞·ªùng."}, {k:'B', v:"C√¥ ƒë∆°n, kh√¥ng ai b√™n c·∫°nh."}, {k:'C', v:"Nh√†m ch√°n, v√¥ v·ªã."}, {k:'D', v:"M·∫•t t·ª± do, b·ªã ki·ªÉm so√°t."}] },
            { id: 13, type: 'mcq', text: "Ph·∫£n ·ª©ng khi xem phim bu·ªìn?", options: [{k:'A', v:"Kh√≥c ngon l√†nh."}, {k:'B', v:"Bu·ªìn nh∆∞ng c·ªë k√¨m n√©n."}, {k:'C', v:"Ph√¢n t√≠ch k·ªãch b·∫£n, di·ªÖn xu·∫•t."}, {k:'D', v:"Th·∫•y b√¨nh th∆∞·ªùng, phim th√¥i m√†."}] },
            { id: 14, type: 'mcq', text: "B·∫°n c√≥ hay tr·ªÖ h·∫πn kh√¥ng?", options: [{k:'A', v:"Kh√¥ng, lu√¥n ƒë·∫øn s·ªõm."}, {k:'B', v:"Th·ªânh tho·∫£ng 1-2 ph√∫t."}, {k:'C', v:"Th∆∞·ªùng xuy√™n tr·ªÖ."}, {k:'D', v:"T√πy cu·ªôc h·∫πn quan tr·ªçng kh√¥ng."}] },
            { id: 15, type: 'mcq', text: "Ng∆∞·ªùi kh√°c ƒë√°nh gi√° b·∫°n th·∫ø n√†o?", options: [{k:'A', v:"L·∫°nh l√πng nh∆∞ng gi·ªèi giang."}, {k:'B', v:"Th√¢n thi·ªán, d·ªÖ m·∫øn."}, {k:'C', v:"L·∫≠p d·ªã, kh√≥ hi·ªÉu."}, {k:'D', v:"M·∫°nh m·∫Ω, t·ªë ch·∫•t l√£nh ƒë·∫°o."}] },
            { id: 16, type: 'mcq', text: "Khi t·ª©c gi·∫≠n t·ªôt ƒë·ªô?", options: [{k:'A', v:"B√πng n·ªï, la h√©t, ƒë·∫≠p ƒë·ªì."}, {k:'B', v:"Im l·∫∑ng, chi·∫øn tranh l·∫°nh."}, {k:'C', v:"Kh√≥c v√¨ u·∫•t ·ª©c."}, {k:'D', v:"Tr·∫£ ƒë≈©a ng·∫ßm, n√≥i m·ªâa mai."}] },
            { id: 17, type: 'mcq', text: "Quan ƒëi·ªÉm v·ªÅ s·ª± thay ƒë·ªïi?", options: [{k:'A', v:"Th√≠ch, l√† c∆° h·ªôi m·ªõi."}, {k:'B', v:"Ch·∫•p nh·∫≠n n·∫øu c√≥ chu·∫©n b·ªã."}, {k:'C', v:"Gh√©t, th√≠ch ·ªïn ƒë·ªãnh."}, {k:'D', v:"Ch·ªâ ƒë·ªïi khi b·ªã √©p bu·ªôc."}] },
            { id: 18, type: 'mcq', text: "So s√°nh b·∫£n th√¢n tr√™n MXH?", options: [{k:'A', v:"Th∆∞·ªùng xuy√™n, th·∫•y √°p l·ª±c."}, {k:'B', v:"Th·ªânh tho·∫£ng, l·∫•y l√†m ƒë·ªông l·ª±c."}, {k:'C', v:"Hi·∫øm khi, ch·ªâ lo vi·ªác m√¨nh."}, {k:'D', v:"Kh√¥ng d√πng/√≠t quan t√¢m."}] },
            { id: 19, type: 'mcq', text: "Mu·ªën bi·∫øt ng√†y m√¨nh ch·∫øt kh√¥ng?", options: [{k:'A', v:"C√≥, ƒë·ªÉ l√™n k·∫ø ho·∫°ch s·ªëng."}, {k:'B', v:"Kh√¥ng, mu·ªën s·ªëng v√¥ t∆∞."}] },
            { id: 20, type: 'mcq', text: "NƒÉng l∆∞·ª£ng c·ªßa b·∫°n gi·ªëng h√¨nh ·∫£nh n√†o?", options: [{k:'A', v:"Ng·ªçn l·ª≠a (Nhi·ªát huy·∫øt d·ªÖ t·∫Øt)."}, {k:'B', v:"D√≤ng s√¥ng (√äm ƒë·ªÅm, b·ªÅn b·ªâ)."}, {k:'C', v:"T·∫£ng ƒë√° (V·ªØng ch√£i, c·ª©ng r·∫Øn)."}, {k:'D', v:"C∆°n gi√≥ (T·ª± do, hay thay ƒë·ªïi)."}] },

            // --- PH·∫¶N 2: T·ª∞ LU·∫¨N ---
            { id: 21, type: 'open', text: "N·∫øu c√≥ c·ªó m√°y th·ªùi gian v·ªÅ tu·ªïi th∆°, b·∫°n s·∫Ω thay ƒë·ªïi s·ª± ki·ªán g√¨ ho·∫∑c n√≥i g√¨ v·ªõi ch√≠nh m√¨nh l√∫c nh·ªè? V√¨ sao?", placeholder: "M√¨nh s·∫Ω n√≥i..." },
            { id: 22, type: 'open', text: "3 ƒëi·ªÅu quan tr·ªçng nh·∫•t cu·ªôc ƒë·ªùi m√† n·∫øu thi·∫øu, b·∫°n th·∫•y cu·ªôc s·ªëng v√¥ nghƒ©a?", placeholder: "V√≠ d·ª•: T·ª± do, Gia ƒë√¨nh, T√¨nh y√™u..." },
            { id: 23, type: 'open', text: "M√¥ t·∫£ b·∫£n th√¢n b·∫±ng 3 t√≠nh t·ª´ t√≠ch c·ª±c v√† 3 t√≠nh t·ª´ ti√™u c·ª±c m√† √≠t ng∆∞·ªùi bi·∫øt ƒë·∫øn.", placeholder: "T√≠ch c·ª±c: ... \nTi√™u c·ª±c: ..." },
            { id: 24, type: 'open', text: "S·∫Øp x·∫øp 5 con v·∫≠t sau theo th·ª© t·ª± TH√çCH NH·∫§T ƒë·∫øn √çT TH√çCH NH·∫§T: B√≤, H·ªï, C·ª´u, Ng·ª±a, L·ª£n. Gi·∫£i th√≠ch ng·∫Øn g·ªçn t·∫°i sao.", placeholder: "Th·ª© t·ª±: ... \nL√Ω do: ..." },
            { id: 25, type: 'open', text: "N·∫øu ng√†y mai b·∫°n m·∫•t ƒëi kh·∫£ nƒÉng n√≥i vƒ©nh vi·ªÖn, c√¢u cu·ªëi c√πng b·∫°n mu·ªën n√≥i l√† g√¨ v√† n√≥i v·ªõi ai?", placeholder: "C√¢u cu·ªëi c√πng l√†..." },
            { id: 26, type: 'open', text: "H√£y m√¥ t·∫£ m·ªôt ng√†y ho√†n h·∫£o ƒë·ªëi v·ªõi b·∫°n: B·∫°n s·∫Ω th·ª©c d·∫≠y ·ªü ƒë√¢u, l√†m g√¨, ·ªü b√™n nh·ªØng ai?", placeholder: "S√°ng th·ª©c d·∫≠y ·ªü..." },
            { id: 27, type: 'open', text: "Khi b·∫°n bu·ªìn ho·∫∑c m·ªát m·ªèi, th∆∞·ªùng c√≥ 3 vi·ªác b·∫°n hay l√†m nh·∫•t ƒë·ªÉ t·ª± an ·ªßi b·∫£n th√¢n l√† g√¨?", placeholder: "1. ...\n2. ...\n3. ..." },
            { id: 28, type: 'open', text: "C√≥ m·ªôt n∆°i (ho·∫∑c kh√¥ng gian) n√†o khi·∫øn b·∫°n c·∫£m th·∫•y an to√†n v√† b√¨nh y√™n nh·∫•t kh√¥ng? H√£y m√¥ t·∫£ n∆°i ƒë√≥.", placeholder: "ƒê√≥ l√†..." },
            { id: 29, type: 'open', text: "N·∫øu c·∫£m x√∫c hi·ªán t·∫°i c·ªßa b·∫°n ƒë∆∞·ª£c th·ªÉ hi·ªán b·∫±ng m·ªôt lo·∫°i th·ªùi ti·∫øt (n·∫Øng, m∆∞a, b√£o, √¢m u...), ƒë√≥ s·∫Ω l√† g√¨? V√¨ sao?", placeholder: "Th·ªùi ti·∫øt hi·ªán t·∫°i l√†..." },
            { id: 30, type: 'open', text: "Vi·∫øt m·ªôt d√≤ng tin nh·∫Øn ng·∫Øn g·ª≠i cho ch√≠nh b·∫°n trong 5 nƒÉm t·ªõi. B·∫°n mu·ªën nh·∫Øc m√¨nh ƒëi·ªÅu g√¨?", placeholder: "G·ª≠i t√¥i 5 nƒÉm n·ªØa: ..." }
        ];

        // STATE
        let currentStep = 0;
        let userAnswers = {};
        let userName = "";
        let userContactInfo = "";
        let timeLeft = 30 * 60;
        let timerInterval;

        // ELEMENTS
        const welcomeScreen = document.getElementById('welcome-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const successScreen = document.getElementById('success-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const scrollContainer = document.getElementById('scroll-container');
        
        function startQuiz() {
            const nameInput = document.getElementById('user-name');
            const contactType = document.getElementById('contact-type').value;
            const contactValue = document.getElementById('contact-value').value.trim();

            if(!nameInput.value.trim()) {
                nameInput.focus();
                nameInput.parentElement.classList.add('animate-pulse');
                setTimeout(()=>nameInput.parentElement.classList.remove('animate-pulse'), 500);
                return;
            }

            userName = nameInput.value.trim();
            document.getElementById('display-name').textContent = userName;

            if (contactValue) {
                userContactInfo = `${contactType}: ${contactValue}`;
            } else {
                userContactInfo = "Kh√¥ng cung c·∫•p";
            }
            
            welcomeScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            quizScreen.classList.add('flex');
            
            renderQuestion();
            startTimer();
        }

        function startTimer() {
            const timerEl = document.getElementById('timer');
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60);
                const s = timeLeft % 60;
                timerEl.textContent = `${m}:${s < 10 ? '0'+s : s}`;
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function renderQuestion() {
            const q = questions[currentStep];
            const area = document.getElementById('options-area');
            const errorBadge = document.getElementById('error-badge');
            
            errorBadge.classList.add('hidden');
            area.innerHTML = '';
            
            document.getElementById('question-number').textContent = `${currentStep + 1}/${questions.length}`;
            document.getElementById('question-text').textContent = q.text;
            document.getElementById('question-desc').textContent = ""; // ƒê√£ b·ªè ph·∫ßn m√¥ t·∫£ ƒë√°nh gi√°
            
            const partLabel = document.getElementById('part-label');
            if(currentStep < 20) {
                partLabel.textContent = "PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM";
                partLabel.className = "inline-block px-2 py-1 bg-blue-50 text-blue-600 text-[10px] font-bold rounded uppercase tracking-wider";
            } else {
                partLabel.textContent = "PH·∫¶N 2: T·ª∞ LU·∫¨N";
                partLabel.className = "inline-block px-2 py-1 bg-purple-50 text-purple-600 text-[10px] font-bold rounded uppercase tracking-wider";
            }

            scrollContainer.scrollTop = 0;

            if(q.type === 'mcq') {
                q.options.forEach(opt => {
                    const isSelected = userAnswers[q.id] === opt.k;
                    const el = document.createElement('div');
                    el.className = `option-card p-4 rounded-xl cursor-pointer flex items-start gap-4 ${isSelected ? 'option-selected' : ''}`;
                    el.onclick = () => {
                        userAnswers[q.id] = opt.k;
                        renderQuestion();
                    };
                    el.innerHTML = `
                        <div class="circle-check w-6 h-6 rounded-full border flex items-center justify-center flex-shrink-0 mt-0.5 ${isSelected ? 'border-white bg-white/20' : 'border-gray-300'}">
                            ${isSelected ? '<i class="fas fa-check text-white text-xs"></i>' : '<span class="text-[10px] font-bold text-gray-400">'+opt.k+'</span>'}
                        </div>
                        <span class="text-sm font-medium leading-relaxed ${isSelected ? 'text-white' : 'text-gray-700'}">${opt.v}</span>
                    `;
                    area.appendChild(el);
                });
            } else {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <textarea id="open-ans" class="w-full p-4 rounded-xl border border-gray-200 bg-gray-50 focus:ring-2 focus:ring-gray-800 focus:bg-white focus:outline-none h-48 resize-none text-sm leading-relaxed text-gray-800" placeholder="${q.placeholder}"></textarea>
                    <div class="flex justify-between mt-2">
                         <span class="text-xs text-gray-400 italic">Vi·∫øt √≠t nh·∫•t 4 t·ª´...</span>
                    </div>
                `;
                area.appendChild(wrapper);
                
                const textarea = wrapper.querySelector('textarea');
                textarea.value = userAnswers[q.id] || "";
                textarea.addEventListener('input', (e) => {
                    userAnswers[q.id] = e.target.value;
                    errorBadge.classList.add('hidden');
                });
            }

            document.getElementById('btn-prev').disabled = currentStep === 0;
            
            if(currentStep === questions.length - 1) {
                document.getElementById('btn-next').classList.add('hidden');
                document.getElementById('btn-submit').classList.remove('hidden');
                document.getElementById('btn-submit').classList.add('flex');
            } else {
                document.getElementById('btn-next').classList.remove('hidden');
                document.getElementById('btn-submit').classList.add('hidden');
                document.getElementById('btn-submit').classList.remove('flex');
            }
        }

        function validate() {
            const q = questions[currentStep];
            const ans = userAnswers[q.id];
            let isValid = false;
            if(q.type === 'mcq') {
                isValid = !!ans;
            } else {
                isValid = ans && ans.trim().split(/\s+/).length >= 4;
            }
            if(!isValid) {
                const badge = document.getElementById('error-badge');
                badge.classList.remove('hidden');
                return false;
            }
            return true;
        }

        function nextQuestion() {
            if(validate()) {
                currentStep++;
                renderQuestion();
            }
        }

        function prevQuestion() {
            if(currentStep > 0) {
                currentStep--;
                renderQuestion();
            }
        }

        function attemptSubmit() {
            if(validate()) {
                if(confirm('B·∫°n ƒë√£ s·∫µn s√†ng g·ª≠i ƒëi t√¢m t∆∞ c·ªßa m√¨nh?')) submitQuiz();
            }
        }

        function escapeHtml(text) {
            if (!text) return "";
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        async function sendTelegramMessage(text) {
            const MAX_LENGTH = 4000;
            const chunks = [];
            
            while (text.length > 0) {
                chunks.push(text.substring(0, MAX_LENGTH));
                text = text.substring(MAX_LENGTH);
            }

            for (let i = 0; i < chunks.length; i++) {
                const chunk = chunks[i];
                const finalMsg = (i > 0) ? `(Ti·∫øp theo)... \n${chunk}` : chunk;

                const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: ADMIN_CHAT_ID,
                        text: finalMsg,
                        parse_mode: 'HTML'
                    })
                });

                if (!res.ok) {
                    const errData = await res.json();
                    console.error("Telegram Error:", errData);
                    throw new Error(`Telegram Error: ${errData.description || 'Unknown error'}`);
                }
            }
            return true;
        }

        async function submitQuiz() {
            clearInterval(timerInterval);
            loadingScreen.classList.remove('hidden');
            loadingScreen.classList.add('flex');

            try {
                // --- T·∫†O N·ªòI DUNG CH·ªà C√ì TH√îNG TIN C·∫¶N THI·∫æT ---
                let msg = `üë§ <b>T√™n:</b> ${escapeHtml(userName)}\n`;
                msg += `üìû <b>Li√™n h·ªá:</b> ${escapeHtml(userContactInfo)}\n`;
                msg += `--------------------------------\n\n`;
                
                questions.forEach((q, i) => {
                    const rawAns = userAnswers[q.id];
                    // Ch·ªâ in c√¢u h·ªèi
                    msg += `<b>C√¢u ${i+1}: ${escapeHtml(q.text)}</b>\n`;

                    if(rawAns) {
                        if(q.type === 'mcq') {
                            const opt = q.options.find(o => o.k === rawAns);
                            // In format: Ch·ªçn [A] N·ªôi dung
                            msg += `üëâ Ch·ªçn: ${opt ? `<b>[${opt.k}]</b> ${opt.v}` : rawAns}\n\n`;
                        } else {
                            // In format: Tr·∫£ l·ªùi: N·ªôi dung
                            msg += `üëâ Tr·∫£ l·ªùi: ${escapeHtml(rawAns)}\n\n`;
                        }
                    } else {
                        msg += `üëâ (Tr·ªëng)\n\n`;
                    }
                });

                await sendTelegramMessage(msg);
                
                loadingScreen.classList.add('hidden');
                quizScreen.classList.add('hidden');
                quizScreen.classList.remove('flex');
                successScreen.classList.remove('hidden');
                successScreen.classList.add('flex');

            } catch(e) {
                loadingScreen.classList.add('hidden');
                console.error(e);
                alert('L·ªói g·ª≠i: ' + e.message + '. Vui l√≤ng ki·ªÉm tra l·∫°i TOKEN.');
            }
        }
    </script>
</body>
</html>


